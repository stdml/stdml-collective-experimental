#!/bin/sh
set -e

# defaults
VERBOSE=0

. ./auto/cmake

parse_args() {
    for i in "$@"; do
        case $i in
        --prefix=*)
            PREFIX="${i#*=}"
            ;;
        --verbose)
            VERBOSE=1
            ;;
        --quiet)
            QUIET=1
            ;;
        --tests)
            BUILD_TESTS=1
            ;;
        *)
            echo "unknown argument $i"
            exit 1
            ;;
        esac
    done
}

add_cmake_prefixes() {
    add_cmake_prefix $HOME/local
}

add_cmake_flags() {
    pass_cmake_flag_from_env CMAKE_INSTALL_PREFIX PREFIX
    pass_cmake_flag_from_env STDTRACER_GIT_URL

    add_cmake_flag EXECUTABLE_OUTPUT_PATH $PWD/bin
    add_cmake_flag LIBRARY_OUTPUT_PATH $PWD/lib
    add_cmake_flag CMAKE_BUILD_TYPE Release
    add_cmake_flag STDTRACER_GIT_TAG timeline

    add_cmake_flag CMAKE_EXPORT_COMPILE_COMMANDS ${VERBOSE}
    add_cmake_flag CMAKE_VERBOSE_MAKEFILE ${VERBOSE}
}

main() {
    export CXX=$(which g++-10)
    parse_args $@
    config_cmake
}

main $@
